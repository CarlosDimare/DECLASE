<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>De Clase</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Babel is required to parse JSX in the browser -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap"
    rel="stylesheet">
  <style>
    body {
      font-family: 'Inter', sans-serif;
    }

    .ticker-wrap {
      width: 100%;
      overflow: hidden;
      background-color: #7f1d1d;
      color: white;
      white-space: nowrap;
    }

    .ticker {
      display: inline-block;
      animation: ticker 30s linear infinite;
    }

    @keyframes ticker {
      0% {
        transform: translateX(100%);
      }

      100% {
        transform: translateX(-100%);
      }
    }

    /* Hide scrollbar for cleaner look */
    .scrollbar-hide::-webkit-scrollbar {
      display: none;
    }

    .scrollbar-hide {
      -ms-overflow-style: none;
      scrollbar-width: none;
    }

    /* Mejoras de transiciones */
    .fade-in {
      animation: fadeIn 0.5s ease-in-out;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
      }

      to {
        opacity: 1;
      }
    }

    .slide-up {
      animation: slideUp 0.3s ease-out;
    }

    @keyframes slideUp {
      from {
        transform: translateY(10px);
        opacity: 0;
      }

      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    /* Gradientes para el ticker */
    .ticker-gradient-high {
      background: linear-gradient(135deg, #dc2626, #991b1b);
      box-shadow: 0 0 20px rgba(220, 38, 38, 0.5);
    }

    .ticker-gradient-medium {
      background: linear-gradient(135deg, #b91c1c, #7f1d1d);
    }

    .ticker-gradient-low {
      background: linear-gradient(135deg, #991b1b, #450a0a);
    }

    /* Pulso para elementos importantes */
    @keyframes pulse-red {

      0%,
      100% {
        opacity: 1;
      }

      50% {
        opacity: 0.8;
      }
    }

    .pulse-red {
      animation: pulse-red 2s infinite;
    }

    /* Estilo para botones más pequeños */
    .nav-button {
      padding: 0.75rem 0.5rem;
    }

    /* Estilos para ranking */
    .rank-1 {
      border-left: 4px solid #fbbf24;
    }

    .rank-2 {
      border-left: 4px solid #9ca3af;
    }

    .rank-3 {
      border-left: 4px solid #cd7f32;
    }

    .rank-badge {
      position: absolute;
      top: 12px;
      right: 12px;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 900;
      font-size: 14px;
      border-radius: 50%;
      z-index: 10;
    }

    .rank-1 .rank-badge {
      background: #fbbf24;
      color: #000;
    }

    .rank-2 .rank-badge {
      background: #9ca3af;
      color: #000;
    }

    .rank-3 .rank-badge {
      background: #cd7f32;
      color: #fff;
    }

    .rank-other .rank-badge {
      background: #374151;
      color: #fff;
    }

    /* Badge para paritarias */
    .paritarias-badge {
      position: absolute;
      top: 12px;
      right: 12px;
      background: linear-gradient(135deg, #059669, #047857);
      color: white;
      padding: 8px 12px;
      border-radius: 8px;
      font-weight: 900;
      font-size: 16px;
      box-shadow: 0 4px 12px rgba(5, 150, 105, 0.3);
      z-index: 10;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-width: 80px;
    }

    .paritarias-badge .current-year {
      font-size: 20px;
      line-height: 1;
    }

    .paritarias-badge .year-label {
      font-size: 10px;
      opacity: 0.9;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .paritarias-badge .previous-year {
      font-size: 11px;
      opacity: 0.7;
      margin-top: 2px;
    }
  </style>
  <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
        "lucide-react": "https://esm.sh/lucide-react@0.292.0"
      }
    }
    </script>
</head>

<body class="bg-neutral-950 text-neutral-200 selection:bg-red-700 selection:text-white">
  <div id="root"></div>

  <!-- type="text/babel" data-type="module" allows JSX + ES Modules -->
  <script type="text/babel" data-type="module">
    import React, { useState, useEffect, useCallback, useMemo } from 'react';
    import { createRoot } from 'react-dom/client';
    import {
      TrendingUp, TrendingDown, DollarSign, ArrowRight, MapPin,
      AlertTriangle, CheckCircle2, Calendar, ChevronLeft, ExternalLink,
      FileText, Users, Megaphone, ShieldAlert, Users2, AlertOctagon,
      Clock, LayoutGrid, Radio, RefreshCw, Flame, Server, Rss, CloudSun, X,
      Zap, Activity, TrendingDown as TrendingDownIcon, Scale, BarChart3,
      Trophy, Medal, Award, SortAsc, SortDesc, TrendingUp as TrendingUpIcon
    } from 'lucide-react';

    // --- CONFIGURACIÓN & UTILIDADES ---
    const DB_URL = "https://project-306405745426850694-default-rtdb.firebaseio.com";
    const SECRET = "DJ3tEkH1Erp4v0cPAGsGK4hbyekJumIvIMiUnX9h";
    const AUTH = `?auth=${SECRET}`;

    const sanitizeUnionData = (u) => ({
      ...u,
      nombre: u.nombre || 'Sindicato Sin Nombre',
      slug: u.slug || 'sin-id',
      comisionDirectiva: u.comisionDirectiva || [],
      acciones: u.acciones || {},
      paritarias: u.paritarias || {},
      datosBasicos: u.datosBasicos || { sedePrincipal: 'Sin datos', sitioWeb: '' }
    });

    // --- WIDGET HEADER (FECHA/HORA/CLIMA) ---
    const HeaderWidget = () => {
      const [dateTime, setDateTime] = useState(new Date());
      const [weather, setWeather] = useState({ temp: null, city: null });

      useEffect(() => {
        // Clock
        const timer = setInterval(() => setDateTime(new Date()), 1000);

        // Weather (Free API based on IP approximation to avoid permissions)
        const fetchWeather = async () => {
          try {
            // 1. Get Lat/Lon from IP
            const geoRes = await fetch('https://get.geojs.io/v1/ip/geo.json');
            const geoData = await geoRes.json();

            if (geoData.latitude && geoData.longitude) {
              // 2. Get Weather from Open-Meteo
              const weatherRes = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${geoData.latitude}&longitude=${geoData.longitude}&current=temperature_2m`);
              const weatherData = await weatherRes.json();

              setWeather({
                temp: Math.round(weatherData.current.temperature_2m),
                city: geoData.city
              });
            }
          } catch (e) {
            console.error("Error fetching weather/location", e);
          }
        };
        fetchWeather();

        return () => clearInterval(timer);
      }, []);

      const dateStr = dateTime.toLocaleDateString('es-AR', { weekday: 'short', day: '2-digit', month: 'short' }).toUpperCase();
      const timeStr = dateTime.toLocaleTimeString('es-AR', { hour: '2-digit', minute: '2-digit' });

      return (
        <div className="flex flex-col items-end text-right">
          <div className="flex items-center gap-3 text-white font-bold text-sm tracking-widest font-mono">
            <span>{dateStr}</span>
            <span className="text-red-500">{timeStr}</span>
          </div>
          {weather.temp !== null && (
            <div className="flex items-center gap-1 text-xs text-neutral-500 font-mono uppercase">
              <CloudSun className="w-3 h-3" />
              <span>{weather.city || 'LOCAL'}: {weather.temp}°C</span>
            </div>
          )}
        </div>
      );
    }

    // --- COMPONENTE: ECONOMIC TICKER MEJORADO ---
    const EconomicTicker = () => {
      const [dolares, setDolares] = useState([]);
      const [loading, setLoading] = useState(true);

      useEffect(() => {
        const fetchData = async () => {
          try {
            const response = await fetch('https://dolarapi.com/v1/dolares');
            const data = await response.json();
            const relevant = data.filter((d) => ['oficial', 'blue', 'bolsa'].includes(d.casa));
            setDolares(relevant);
            setLoading(false);
          } catch (error) {
            console.error("Error fetching economic data", error);
            setLoading(false);
          }
        };

        fetchData();
        const interval = setInterval(fetchData, 60000);
        return () => clearInterval(interval);
      }, []);

      if (loading) return <div className="h-12 bg-red-900 w-full animate-pulse flex items-center justify-center">
        <span className="text-red-200 font-mono text-sm">CARGANDO DATOS ECONÓMICOS...</span>
      </div>;

      // Clasificación por importancia desde perspectiva de clase
      const getImportanceLevel = (item) => {
        if (item.includes('INFLACIÓN')) return 'high';
        if (item.includes('BLUE')) return 'high';
        if (item.includes('OFICIAL')) return 'medium';
        if (item.includes('RIESGO')) return 'low';
        return 'medium';
      };

      const getTickerStyle = (level) => {
        switch (level) {
          case 'high':
            return 'ticker-gradient-high text-white px-6 py-3';
          case 'medium':
            return 'ticker-gradient-medium text-red-100 px-4 py-2';
          case 'low':
            return 'ticker-gradient-low text-red-200 px-3 py-1';
          default:
            return 'bg-red-900 text-red-200 px-3 py-1';
        }
      };

      const getIcon = (item) => {
        if (item.includes('INFLACIÓN')) return <Scale className="w-5 h-5" />;
        if (item.includes('BLUE')) return <TrendingUp className="w-5 h-5" />;
        if (item.includes('OFICIAL')) return <DollarSign className="w-4 h-4" />;
        if (item.includes('RIESGO')) return <Activity className="w-4 h-4" />;
        if (item.includes('BOLSA')) return <BarChart3 className="w-4 h-4" />;
        return <Zap className="w-4 h-4" />;
      };

      const getTextSize = (level) => {
        switch (level) {
          case 'high': return 'text-base font-black';
          case 'medium': return 'text-sm font-bold';
          case 'low': return 'text-xs font-semibold';
          default: return 'text-xs';
        }
      };

      return (
        <div className="bg-gradient-to-r from-red-950 via-red-900 to-red-950 border-b-2 border-red-800 overflow-hidden relative shadow-2xl">
          <div className="ticker-wrap flex items-center h-12">
            <div className="ticker inline-flex items-center gap-4">

              {/* INFLACIÓN - MÁXIMA IMPORTANCIA */}
              <div className={`inline-flex items-center gap-3 rounded-lg ${getTickerStyle('high')} pulse-red`}>
                {getIcon('INFLACIÓN')}
                <div className="flex flex-col">
                  <span className="text-xs font-mono opacity-90">PODER ADQUISITIVO</span>
                  <span className={getTextSize('high')}>INFLACIÓN: 4.2% MENSUAL</span>
                </div>
              </div>

              <span className="text-red-800 text-2xl">•</span>

              {/* DÓLAR BLUE - MÁXIMA IMPORTANCIA */}
              {dolares.filter(d => d.casa === 'blue').map((d) => (
                <div key={d.casa} className={`inline-flex items-center gap-3 rounded-lg ${getTickerStyle('high')}`}>
                  {getIcon('BLUE')}
                  <div className="flex flex-col">
                    <span className="text-xs font-mono opacity-90">DÓLAR INFORMAL</span>
                    <span className={getTextSize('high')}>BLUE: C ${d.compra} / V ${d.venta}</span>
                  </div>
                </div>
              ))}

              <span className="text-red-800 text-2xl">•</span>

              {/* DÓLAR OFICIAL - IMPORTANCIA MEDIA */}
              {dolares.filter(d => d.casa === 'oficial').map((d) => (
                <div key={d.casa} className={`inline-flex items-center gap-2 ${getTickerStyle('medium')}`}>
                  {getIcon('OFICIAL')}
                  <span className={getTextSize('medium')}>OFICIAL: C ${d.compra} / V ${d.venta}</span>
                </div>
              ))}

              <span className="text-red-800 text-2xl">•</span>

              {/* DÓLAR BOLSA - IMPORTANCIA MEDIA */}
              {dolares.filter(d => d.casa === 'bolsa').map((d) => (
                <div key={d.casa} className={`inline-flex items-center gap-2 ${getTickerStyle('medium')}`}>
                  {getIcon('BOLSA')}
                  <span className={getTextSize('medium')}>MEP: C ${d.compra} / V ${d.venta}</span>
                </div>
              ))}

              <span className="text-red-800 text-2xl">•</span>

              {/* RIESGO PAÍS - IMPORTANCIA BAJA */}
              <div className={`inline-flex items-center gap-2 ${getTickerStyle('low')}`}>
                {getIcon('RIESGO')}
                <span className={getTextSize('low')}>RIESGO PAÍS: 1450 PB</span>
              </div>

              <span className="text-red-800 text-2xl mx-4">///</span>

              {/* REPETICIÓN PARA EFECTO CONTINUO */}
              {/* INFLACIÓN - MÁXIMA IMPORTANCIA */}
              <div className={`inline-flex items-center gap-3 rounded-lg ${getTickerStyle('high')} pulse-red`}>
                {getIcon('INFLACIÓN')}
                <div className="flex flex-col">
                  <span className="text-xs font-mono opacity-90">PODER ADQUISITIVO</span>
                  <span className={getTextSize('high')}>INFLACIÓN: 4.2% MENSUAL</span>
                </div>
              </div>

              <span className="text-red-800 text-2xl">•</span>

              {/* DÓLAR BLUE - MÁXIMA IMPORTANCIA */}
              {dolares.filter(d => d.casa === 'blue').map((d) => (
                <div key={`${d.casa}-dup`} className={`inline-flex items-center gap-3 rounded-lg ${getTickerStyle('high')}`}>
                  {getIcon('BLUE')}
                  <div className="flex flex-col">
                    <span className="text-xs font-mono opacity-90">DÓLAR INFORMAL</span>
                    <span className={getTextSize('high')}>BLUE: C ${d.compra} / V ${d.venta}</span>
                  </div>
                </div>
              ))}

            </div>
          </div>
        </div>
      );
    };

    // --- COMPONENTE: UNION CARD MEJORADO CON RANKING ---
    const UnionCard = ({ data, onSelect, rank, sortType, sortValue, previousYearValue }) => {
      const accionesArray = Object.values(data.acciones || {});

      // Date Logic
      const today = new Date().toISOString().split('T')[0];
      const isUpcoming = (dateStr) => dateStr >= today;

      const upcomingActions = accionesArray
        .filter(a => isUpcoming(a.fecha))
        .sort((a, b) => new Date(a.fecha).getTime() - new Date(b.fecha).getTime())
        .slice(0, 2);

      const pastActions = accionesArray
        .filter(a => !isUpcoming(a.fecha))
        .sort((a, b) => new Date(b.fecha).getTime() - new Date(a.fecha).getTime())
        .slice(0, 2);

      const getRankClass = (rank) => {
        if (rank === 1) return 'rank-1';
        if (rank === 2) return 'rank-2';
        if (rank === 3) return 'rank-3';
        return 'rank-other';
      };

      const getRankIcon = (rank) => {
        if (rank === 1) return <Trophy className="w-4 h-4" />;
        if (rank === 2) return <Medal className="w-4 h-4" />;
        if (rank === 3) return <Award className="w-4 h-4" />;
        return <span className="text-xs font-bold">#{rank}</span>;
      };

      const currentYear = new Date().getFullYear();
      const previousYear = currentYear - 1;

      return (
        <div className={`group bg-neutral-900 border border-neutral-800 rounded-none hover:border-red-600 transition-all duration-300 flex flex-col h-full relative overflow-hidden shadow-lg hover:shadow-xl hover:shadow-red-900/10 ${sortType === 'acciones' && rank ? getRankClass(rank) : ''}`}>
          {/* Badge para ranking de acciones */}
          {sortType === 'acciones' && rank && (
            <div className={`rank-badge ${getRankClass(rank)}`}>
              {rank <= 3 ? getRankIcon(rank) : rank}
            </div>
          )}

          {/* Badge para paritarias */}
          {sortType === 'paritarias' && sortValue !== null && typeof sortValue === 'number' && !isNaN(sortValue) && (
            <div className="paritarias-badge">
              <span className="current-year">{sortValue.toFixed(1)}%</span>
              <span className="year-label">{currentYear}</span>
              {previousYearValue !== null && typeof previousYearValue === 'number' && !isNaN(previousYearValue) && (
                <span className="previous-year">
                  {previousYearValue > sortValue ? (
                    <span className="flex items-center gap-1 text-red-300">
                      <TrendingDownIcon className="w-3 h-3" />
                      {previousYearValue.toFixed(1)}%
                    </span>
                  ) : (
                    <span className="flex items-center gap-1 text-green-300">
                      <TrendingUpIcon className="w-3 h-3" />
                      {previousYearValue.toFixed(1)}%
                    </span>
                  )}
                </span>
              )}
            </div>
          )}

          <div className="p-6 flex-1 pl-7 flex flex-col">
            <div className="flex justify-between items-start mb-4">
              <div className="flex items-center gap-3">
                {data.datosBasicos.logo && (
                  <div className="w-12 h-12 bg-white rounded-full p-1 flex items-center justify-center shrink-0 border-2 border-neutral-700">
                    <img
                      src={data.datosBasicos.logo}
                      alt={`${data.nombre} logo`}
                      className="max-w-full max-h-full object-contain"
                      onError={(e) => { e.target.style.display = 'none'; }}
                    />
                  </div>
                )}
                <div>
                  <span className="inline-block px-2 py-0.5 bg-neutral-800 text-neutral-300 text-2xl font-black tracking-widest uppercase mb-3 border border-neutral-700">
                    {data.slug}
                  </span>
                  <h3 className="text-sm font-black text-white leading-none uppercase tracking-tight">{data.nombre}</h3>
                </div>
              </div>
            </div>

            {/* Indicador de ordenamiento */}
            {sortType && sortValue !== null && (sortType !== 'paritarias' || (typeof sortValue === 'number' && !isNaN(sortValue))) && (
              <div className="mb-4 p-2 bg-neutral-800 border border-neutral-700 rounded">
                <div className="flex items-center justify-between">
                  <span className="text-xs font-bold text-neutral-400 uppercase">
                    {sortType === 'acciones' ? 'Próxima Acción' : 'Total Paritarias'}
                  </span>
                  <span className="text-sm font-black text-white">
                    {sortType === 'acciones' ? sortValue : `${(typeof sortValue === 'number' && !isNaN(sortValue) ? sortValue.toFixed(1) : '0.0')}%`}
                  </span>
                </div>
              </div>
            )}

            <div className="bg-red-950/30 border border-red-900/50 p-3 rounded-lg mb-6">
              <div className="flex items-center gap-2 mb-1">
                <Users className="w-5 h-5 text-red-400" />
                <span className="text-red-300 text-xs font-bold uppercase tracking-wider">Secretario General</span>
              </div>
              <span className="text-white text-lg font-black uppercase">{data.comisionDirectiva.find(m => m.cargo.toLowerCase().includes('general'))?.nombre || 'NO ESPECIFICADO'}</span>
            </div>

            <div className="mt-auto space-y-4 border-t border-neutral-800 pt-4">
              {upcomingActions.length > 0 ? (
                <div className="bg-red-900/20 border-l-2 border-red-600 p-2 space-y-2">
                  <div className="flex items-center gap-2 mb-1">
                    <AlertTriangle className="w-3 h-3 text-red-500" />
                    <span className="text-[10px] uppercase font-bold text-red-400 tracking-wider">Próximas Acciones</span>
                  </div>
                  {upcomingActions.map((action, idx) => (
                    <div key={idx} className="border-b border-red-900/30 last:border-0 pb-1 last:pb-0">
                      <div className="flex justify-between items-center text-[10px] text-red-300 font-mono mb-0.5">
                        <span>{action.fecha}</span>
                        <span className="uppercase">{action.tipo}</span>
                      </div>
                      <p className="text-white text-xs font-bold leading-tight line-clamp-1">{action.titulo}</p>
                    </div>
                  ))}
                </div>
              ) : (
                <div className="p-2 opacity-50">
                  <div className="flex items-center gap-2 mb-1">
                    <Calendar className="w-3 h-3 text-neutral-500" />
                    <span className="text-[10px] uppercase font-bold text-neutral-500 tracking-wider">Sin agenda próxima</span>
                  </div>
                </div>
              )}

              {pastActions.length > 0 && (
                <div className="pl-2 border-l-2 border-neutral-700 space-y-2">
                  <div className="flex items-center gap-2 mb-1">
                    <CheckCircle2 className="w-3 h-3 text-neutral-500" />
                    <span className="text-[10px] uppercase font-bold text-neutral-500 tracking-wider">Últimas Acciones</span>
                  </div>
                  {pastActions.map((action, idx) => (
                    <div key={idx}>
                      <div className="flex justify-between items-center text-[10px] text-neutral-500 font-mono mb-0.5">
                        <span>{action.fecha}</span>
                      </div>
                      <p className="text-neutral-400 text-xs leading-tight line-clamp-1">{action.titulo}</p>
                    </div>
                  ))}
                </div>
              )}
            </div>
          </div>

          <div className="bg-neutral-950 p-4 border-t border-neutral-800 flex items-center justify-end pl-7">
            <button
              onClick={() => onSelect(data)}
              className="text-red-500 text-sm font-bold uppercase tracking-wider flex items-center gap-2 hover:text-red-400 transition-all"
            >
              VER INFORME COMPLETO <ArrowRight className="w-4 h-4" />
            </button>
          </div>
        </div >
      );
    };

    // --- COMPONENTE: NEWS FEED ---
    const NewsFeed = ({ news, loading, error, onRefresh }) => {
      const [selectedNews, setSelectedNews] = useState(null);

      // Helper calculation
      const timeAgo = (dateStr) => {
        const date = new Date(dateStr);
        const now = new Date();
        const seconds = Math.floor((now.getTime() - date.getTime()) / 1000);

        if (seconds < 60) return 'Hace un momento';
        const minutes = Math.floor(seconds / 60);
        if (minutes < 60) return `Hace ${minutes} min`;
        const hours = Math.floor(minutes / 60);
        if (hours < 24) return `Hace ${hours} h`;
        const days = Math.floor(hours / 24);
        if (days === 1) return 'Ayer';
        if (days < 7) return `Hace ${days} días`;
        return date.toLocaleDateString('es-AR');
      };

      // Función para capitalizar correctamente en español
      const capitalizeCorrectly = (str) => {
        // Convertir todo a minúsculas primero
        let result = str.toLowerCase();

        // Lista de palabras que siempre van en minúscula (excepto al inicio)
        const lowerCaseWords = ['el', 'la', 'los', 'las', 'un', 'una', 'unos', 'unas', 'de', 'del', 'y', 'o', 'pero', 'mas', 'ni', 'que', 'al', 'se', 'sus', 'mi', 'mis', 'tu', 'tus', 'su', 'en', 'con', 'por', 'para', 'como', 'según', 'sin', 'sobre', 'entre', 'hacia', 'hasta'];

        // Palabras que siempre van en mayúscula
        const upperCaseWords = ['argentina', 'arg', 'cba', 'bsas', 'caba'];

        // Dividir en palabras
        const words = result.split(' ');

        // Procesar cada palabra
        const processedWords = words.map((word, index) => {
          // Si es la primera palabra o después de un punto, siempre va en mayúscula
          if (index === 0 || (index > 0 && words[index - 1].endsWith('.'))) {
            // Verificar si es una palabra que debe ir en mayúscula
            if (upperCaseWords.includes(word.toLowerCase())) {
              return word.toUpperCase();
            }
            // Capitalizar la primera letra
            return word.charAt(0).toUpperCase() + word.slice(1);
          }

          // Verificar si es una palabra que debe ir en mayúscula
          if (upperCaseWords.includes(word.toLowerCase())) {
            return word.toUpperCase();
          }

          // Verificar si es una palabra que debe ir en minúscula
          if (lowerCaseWords.includes(word.toLowerCase())) {
            return word;
          }

          // Capitalizar la primera letra
          return word.charAt(0).toUpperCase() + word.slice(1);
        });

        return processedWords.join(' ');
      };

      return (
        <div className="bg-neutral-900 border border-neutral-800 min-h-[500px] relative">

          {/* MODAL OVERLAY */}
          {selectedNews && (
            <div className="fixed inset-0 z-[100] flex items-center justify-center bg-black/80 backdrop-blur-sm p-4 fade-in" onClick={() => setSelectedNews(null)}>
              <div className="bg-neutral-900 border border-neutral-700 max-w-2xl w-full max-h-[90vh] overflow-y-auto shadow-2xl relative slide-up" onClick={(e) => e.stopPropagation()}>

                {/* Modal Header */}
                <div className="p-6 border-b border-neutral-800 flex justify-between items-start sticky top-0 bg-neutral-900/95 backdrop-blur z-10">
                  <div>
                    <span className="inline-block px-2 py-0.5 bg-red-900/30 text-red-400 border border-red-900/50 text-[10px] font-black uppercase tracking-wider mb-2">
                      {selectedNews.source}
                    </span>
                    <h2 className="text-xl md:text-2xl font-black text-white leading-tight">{selectedNews.title}</h2>
                    <div className="flex items-center gap-2 mt-2 text-xs text-neutral-500 font-mono">
                      <Clock className="w-3 h-3" /> {selectedNews.pubDate}
                    </div>
                  </div>
                  <button onClick={() => setSelectedNews(null)} className="text-neutral-500 hover:text-white p-2">
                    <X className="w-6 h-6" />
                  </button>
                </div>

                {/* Modal Body */}
                <div className="p-6 space-y-4">
                  {/* Bajada */}
                  <div className="text-neutral-300 font-medium text-lg leading-relaxed border-l-4 border-red-600 pl-4 italic">
                    {selectedNews.description}
                  </div>

                  {/* Cuerpo (Content) */}
                  <div className="text-neutral-400 text-sm leading-relaxed space-y-4 font-serif">
                    {/* We render content as HTML if available */}
                    {selectedNews.content && selectedNews.content !== selectedNews.description ? (
                      <div dangerouslySetInnerHTML={{ __html: selectedNews.content }} className="prose prose-invert prose-sm max-w-none" />
                    ) : (
                      <p>Para leer el desarrollo completo de la noticia, visite la fuente original.</p>
                    )}
                  </div>
                </div>

                {/* Modal Footer */}
                <div className="p-6 border-t border-neutral-800 bg-neutral-950">
                  <a
                    href={selectedNews.link}
                    target="_blank"
                    rel="noreferrer"
                    className="w-full bg-red-700 hover:bg-red-600 text-white font-bold py-3 uppercase tracking-wider text-sm flex items-center justify-center gap-2 transition-colors"
                  >
                    Leer en Fuente Original <ExternalLink className="w-4 h-4" />
                  </a>
                </div>
              </div>
            </div>
          )}

          <div className="bg-neutral-950 p-4 border-b border-neutral-800 flex justify-between items-center">
            <h3 className="text-xl font-black text-white uppercase tracking-tighter flex items-center gap-2">
              <Rss className="w-5 h-5 text-red-600" /> Cables de Noticias
            </h3>
            <button onClick={onRefresh} disabled={loading} className="text-neutral-500 hover:text-white transition-colors">
              <RefreshCw className={`w-4 h-4 ${loading ? 'animate-spin' : ''}`} />
            </button>
          </div>

          <div className="p-0">
            {loading && (
              <div className="p-8 text-center text-neutral-500 font-mono animate-pulse">
                RECUPERANDO INFORMACIÓN DE MEDIOS SINDICALES...
              </div>
            )}

            {!loading && error && (
              <div className="p-8 text-center">
                <p className="text-red-500 font-bold mb-2">ERROR DE CONEXIÓN</p>
                <p className="text-neutral-500 text-sm mb-4">No se pudo conectar con los feeds RSS.</p>
              </div>
            )}

            {!loading && !error && (
              <div className="divide-y divide-neutral-800">
                {news.map((item, idx) => (
                  <div key={idx} className="p-5 hover:bg-neutral-800/50 transition-colors group cursor-pointer" onClick={() => setSelectedNews(item)}>
                    <div className="flex justify-between items-start mb-2">
                      <div className="flex items-center gap-2">
                        <span className="inline-block px-2 py-0.5 bg-red-900/30 text-red-400 border border-red-900/50 text-[10px] font-black uppercase tracking-wider">
                          {item.source}
                        </span>
                        <span className="text-neutral-500 text-[10px] font-bold uppercase flex items-center gap-1">
                          <Clock className="w-3 h-3" /> {timeAgo(item.pubDate)}
                        </span>
                      </div>
                    </div>

                    {/* TÍTULO CON FONDO BLANCO Y TEXTO ROJO - CAMBIO SOLICITADO */}
                    <h4 className="bg-white text-red-600 font-bold text-lg leading-tight mb-2 px-3 py-2 group-hover:bg-red-50 transition-colors">
                      {item.title}
                    </h4>

                    <p className="text-neutral-400 text-sm leading-relaxed line-clamp-2 mb-3">
                      {item.description}
                    </p>
                    <span className="inline-flex items-center gap-1 text-xs font-bold text-neutral-500 hover:text-white uppercase tracking-wider">
                      <FileText className="w-3 h-3" /> Ver Detalle
                    </span>
                  </div>
                ))}
                {news.length === 0 && !loading && (
                  <div className="p-8 text-center text-neutral-600 italic">No hay cables recientes disponibles.</div>
                )}
              </div>
            )}
          </div>

          <div className="bg-neutral-950 p-4 border-t border-neutral-800">
            <h4 className="text-xs font-bold text-neutral-500 uppercase tracking-widest mb-3">Fuentes Directas</h4>
            <div className="flex flex-wrap gap-3">
              <a href="https://www.infogremiales.com.ar/" target="_blank" rel="noreferrer" className="text-xs text-neutral-400 hover:text-red-500 uppercase font-bold flex items-center gap-1">InfoGremiales <ExternalLink className="w-3 h-3" /></a>
              <a href="http://www.infosindical.com.ar/" target="_blank" rel="noreferrer" className="text-xs text-neutral-400 hover:text-red-500 uppercase font-bold flex items-center gap-1">InfoSindical <ExternalLink className="w-3 h-3" /></a>
              <a href="https://mundogremial.com/" target="_blank" rel="noreferrer" className="text-xs text-neutral-400 hover:text-red-500 uppercase font-bold flex items-center gap-1">Mundo Gremial <ExternalLink className="w-3 h-3" /></a>
              <a href="https://gestionsindical.com/" target="_blank" rel="noreferrer" className="text-xs text-neutral-400 hover:text-red-500 uppercase font-bold flex items-center gap-1">Gestión Sindical <ExternalLink className="w-3 h-3" /></a>
            </div>
          </div>
        </div>
      );
    };

    // --- COMPONENTE: PUBLIC VIEW (PRINCIPAL) ---
    const PublicView = ({ unions, news, newsLoading, newsError, onRefreshNews }) => {
      const [selectedUnion, setSelectedUnion] = useState(null);
      const [selectedAction, setSelectedAction] = useState(null);
      const [activeMainTab, setActiveMainTab] = useState('monitor');
      const [activeDetailTab, setActiveDetailTab] = useState('agenda');
      const [sortType, setSortType] = useState(null); // 'acciones', 'paritarias', o null

      // --- Date Logic ---
      const today = new Date().toISOString().split('T')[0];
      const isUpcoming = (dateStr) => dateStr >= today;

      const getAllActions = () => {
        const all = [];
        unions.forEach(union => {
          const acciones = union.acciones || {};
          Object.entries(acciones).forEach(([uuid, action]) => {
            all.push({ action, unionName: union.nombre, unionSlug: union.slug, unionLogo: union.datosBasicos.logo, uuid });
          });
        });
        return all;
      };

      const allActions = getAllActions();

      // ORDENAMIENTO DE ACCIONES
      // Próximas: Orden ascendente (lo más cercano primero)
      const upcomingActions = allActions
        .filter(item => isUpcoming(item.action.fecha))
        .sort((a, b) => new Date(a.action.fecha).getTime() - new Date(b.action.fecha).getTime());

      // Pasadas: Orden descendente (lo más reciente primero)
      const pastActions = allActions
        .filter(item => !isUpcoming(item.action.fecha))
        .sort((a, b) => new Date(b.action.fecha).getTime() - new Date(a.action.fecha).getTime())
        .slice(0, 20);

      const getActionIcon = (type) => {
        switch (type) {
          case 'medida-fuerza': return <ShieldAlert className="w-5 h-5" />;
          case 'movilizacion': return <Megaphone className="w-5 h-5" />;
          case 'asamblea': return <Users2 className="w-5 h-5" />;
          default: return <Calendar className="w-5 h-5" />;
        }
      }

      const getTypeLabel = (type) => {
        if (!type) return 'ACCIÓN';
        const labels = {
          'medida-fuerza': 'MEDIDA DE FUERZA',
          'movilizacion': 'MOVILIZACIÓN',
          'asamblea': 'ASAMBLEA',
          'reunion': 'REUNIÓN',
          'denuncia': 'DENUNCIA',
          'otro': 'ACCIÓN'
        };
        return labels[type] || type.toUpperCase();
      }

      // --- LÓGICA DE ORDENAMIENTO MEJORADA ---
      const sortedUnions = useMemo(() => {
        if (!sortType) return unions;

        let unionsWithSortValue = unions.map(union => {
          let sortValue = null;
          let previousYearValue = null;

          if (sortType === 'acciones') {
            // Encontrar la acción más cercana
            const acciones = Object.values(union.acciones || {});
            const upcomingAcciones = acciones.filter(a => isUpcoming(a.fecha));

            if (upcomingAcciones.length > 0) {
              const closestAction = upcomingAcciones.reduce((closest, current) => {
                const closestDate = new Date(closest.fecha);
                const currentDate = new Date(current.fecha);
                const now = new Date();

                const closestDiff = Math.abs(closestDate - now);
                const currentDiff = Math.abs(currentDate - now);

                return currentDiff < closestDiff ? current : closest;
              });

              sortValue = closestAction.fecha;
            }
          } else if (sortType === 'paritarias') {
            // Sumar porcentajes por año
            const paritarias = Object.values(union.paritarias || {});
            const currentYear = new Date().getFullYear();
            const previousYear = currentYear - 1;

            const yearlyTotals = {};
            paritarias.forEach(paritaria => {
              // Validar que paritaria y sus propiedades existan
              if (!paritaria) return;

              const year = paritaria.fechaFirma ? new Date(paritaria.fechaFirma).getFullYear() : null;
              if (!year) return;

              if (!yearlyTotals[year]) {
                yearlyTotals[year] = 0;
              }

              // Validar que porcentajeAumento exista y sea una cadena
              if (paritaria.porcentajeAumento && typeof paritaria.porcentajeAumento === 'string') {
                // Extraer el número del porcentaje con validación
                const percentMatch = paritaria.porcentajeAumento.match(/(\d+(?:\.\d+)?)/);
                if (percentMatch && percentMatch[1]) {
                  const parsed = parseFloat(percentMatch[1]);
                  if (!isNaN(parsed)) {
                    yearlyTotals[year] += parsed;
                  }
                }
              }
            });

            sortValue = yearlyTotals[currentYear] || 0;
            previousYearValue = yearlyTotals[previousYear] || null;
          } else if (sortType === 'az') {
            sortValue = union.nombre;
          }

          return { ...union, sortValue, previousYearValue };
        });

        // Filtrar sindicatos sin datos de ordenamiento
        const validUnions = unionsWithSortValue.filter(u => u.sortValue !== null);

        // Ordenar
        if (sortType === 'acciones') {
          validUnions.sort((a, b) => new Date(a.sortValue) - new Date(b.sortValue));
        } else if (sortType === 'paritarias') {
          validUnions.sort((a, b) => b.sortValue - a.sortValue);
        } else if (sortType === 'az') {
          validUnions.sort((a, b) => a.sortValue.localeCompare(b.sortValue));
        }

        // Agregar rank solo para acciones
        return validUnions.map((union, index) => ({
          ...union,
          rank: sortType === 'acciones' ? index + 1 : null
        }));
      }, [unions, sortType]);

      // --- DETALLE SINDICATO ---
      if (selectedUnion) {
        const accionesMap = selectedUnion.acciones || {};

        const agendaActions = Object.entries(accionesMap)
          .filter(([, a]) => isUpcoming(a.fecha))
          .sort(([, a], [, b]) => new Date(a.fecha).getTime() - new Date(b.fecha).getTime());

        const historialActions = Object.entries(accionesMap)
          .filter(([, a]) => !isUpcoming(a.fecha))
          .sort(([, a], [, b]) => new Date(b.fecha).getTime() - new Date(a.fecha).getTime());

        return (
          <div className="container mx-auto px-4 py-8">
            <button
              onClick={() => setSelectedUnion(null)}
              className="mb-8 flex items-center text-neutral-500 hover:text-red-500 transition-colors uppercase font-bold text-sm tracking-widest"
            >
              <ChevronLeft className="w-4 h-4 mr-1" /> Volver al Tablero
            </button>

            <div className="bg-neutral-900 border-l-4 border-red-600 p-8 mb-8 shadow-2xl relative">
              <div className="absolute top-0 right-0 w-full h-full bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre.png')] opacity-20 pointer-events-none"></div>
              <div className="flex flex-col md:flex-row md:justify-between md:items-start gap-4 relative z-10">
                <div className="flex items-center gap-3">
                  {selectedUnion.datosBasicos.logo && (
                    <div className="w-6 h-6 bg-white rounded-full p-1 flex items-center justify-center shrink-0 border-2 border-neutral-700">
                      <img
                        src={selectedUnion.datosBasicos.logo}
                        alt={`${selectedUnion.nombre} logo`}
                        className="max-w-full max-h-full object-contain"
                        onError={(e) => { e.target.style.display = 'none'; }}
                      />
                    </div>
                  )}
                  <div>
                    <h1 className="text-4xl md:text-5xl font-black text-white mb-4 uppercase tracking-tighter leading-none">{selectedUnion.nombre}</h1>
                    <div className="flex flex-wrap gap-6 text-sm text-neutral-300 font-mono">
                      <div className="flex items-center gap-2">
                        <Users className="w-4 h-4 text-red-500" />
                        <span className="font-bold text-red-500 uppercase">Conducción:</span>
                        {selectedUnion.comisionDirectiva.find(m => m.cargo.toLowerCase().includes('general'))?.nombre || 'Secretariado General'}
                      </div>
                      <div className="flex items-center gap-2">
                        <ExternalLink className="w-4 h-4 text-red-500" />
                        <a href={selectedUnion.datosBasicos.sitioWeb} target="_blank" rel="noreferrer" className="hover:text-red-500 transition-colors">
                          Sitio Oficial
                        </a>
                      </div>
                    </div>
                  </div>
                </div>
                <div className="bg-neutral-950 px-4 py-2 border border-neutral-800">
                  <span className="text-xs text-neutral-500 uppercase block text-center mb-1">Identificador</span>
                  <span className="text-xl font-black text-white tracking-widest">{selectedUnion.slug ? selectedUnion.slug.toUpperCase() : 'SIN ID'}</span>
                </div>
              </div>
            </div>

            <div className="flex border-b border-neutral-800 mb-8 overflow-x-auto scrollbar-hide">
              <button
                onClick={() => setActiveDetailTab('agenda')}
                className={`px-6 py-4 text-sm font-bold uppercase tracking-wider border-b-2 transition-all flex items-center gap-2 whitespace-nowrap ${activeDetailTab === 'agenda' ? 'border-red-600 text-red-500 bg-neutral-900' : 'border-transparent text-neutral-500 hover:text-neutral-300 hover:bg-neutral-900'}`}
              >
                <Megaphone className="w-4 h-4" /> Agenda de Lucha
              </button>
              <button
                onClick={() => setActiveDetailTab('historial')}
                className={`px-6 py-4 text-sm font-bold uppercase tracking-wider border-b-2 transition-all flex items-center gap-2 whitespace-nowrap ${activeDetailTab === 'historial' ? 'border-red-600 text-red-500 bg-neutral-900' : 'border-transparent text-neutral-500 hover:text-neutral-300 hover:bg-neutral-900'}`}
              >
                <Clock className="w-4 h-4" /> Historial / Pasadas
              </button>
              <button
                onClick={() => setActiveDetailTab('paritarias')}
                className={`px-6 py-4 text-sm font-bold uppercase tracking-wider border-b-2 transition-all flex items-center gap-2 whitespace-nowrap ${activeDetailTab === 'paritarias' ? 'border-red-600 text-red-500 bg-neutral-900' : 'border-transparent text-neutral-500 hover:text-neutral-300 hover:bg-neutral-900'}`}
              >
                <FileText className="w-4 h-4" /> Paritarias
              </button>
            </div>

            <div className="space-y-4 max-w-5xl">
              {activeDetailTab === 'agenda' && (
                <div className="grid gap-6">
                  <div className="bg-red-950/20 border border-red-900/30 p-4 mb-4 text-red-400 text-sm font-bold uppercase tracking-widest flex items-center gap-2">
                    <AlertOctagon className="w-4 h-4" /> Próximas Medidas y Eventos
                  </div>
                  {agendaActions.map(([uuid, accion]) => (
                    <div key={uuid} className="bg-neutral-900 p-6 border border-l-4 border-l-red-600 border-neutral-800 shadow-xl shadow-red-900/5 relative overflow-hidden cursor-pointer" onClick={() => setSelectedAction(accion)}>
                      <div className="absolute top-0 right-0 bg-red-600 text-white text-xs font-black px-3 py-1 uppercase tracking-widest">
                        EN AGENDA
                      </div>
                      <div className="flex items-start gap-4">
                        <div className="p-3 bg-red-900/20 text-red-500 border border-red-900/30">
                          {getActionIcon(accion.tipo)}
                        </div>
                        <div className="flex-1">
                          <div className="flex items-center gap-2 mb-2">
                            <span className="text-red-400 text-xs font-bold uppercase tracking-wider">
                              {getTypeLabel(accion.tipo)}
                            </span>
                            <span className="text-neutral-600 text-xs">•</span>
                            <span className="text-white text-xs font-mono font-bold flex items-center gap-1 bg-red-900/50 px-2 py-0.5 rounded-sm">
                              <Calendar className="w-3 h-3" /> {new Date(accion.fecha + 'T12:00:00').toLocaleDateString('es-AR', { weekday: 'long', day: '2-digit', month: '2-digit', year: 'numeric' })}
                            </span>
                          </div>
                          <h3 className="text-2xl font-black text-white mb-2 uppercase leading-none tracking-tight">{accion.titulo}</h3>
                          <p className="text-neutral-300 mb-4 leading-relaxed font-medium">{accion.descripcion}</p>

                          <div className="flex flex-wrap items-center gap-4 text-sm border-t border-neutral-800 pt-3">
                            <span className="text-neutral-400 font-bold bg-neutral-950 border border-neutral-800 px-2 py-1 text-xs uppercase">
                              LUGAR: {accion.lugar}
                            </span>
                            {accion.fuente && (
                              <a href={accion.fuente} target="_blank" rel="noreferrer" className="text-red-500 hover:underline text-xs font-bold uppercase flex items-center gap-1">
                                Fuente Oficial <ExternalLink className="w-3 h-3" />
                              </a>
                            )}
                          </div>
                        </div>
                      </div>
                    </div>
                  ))}
                  {agendaActions.length === 0 && <p className="text-neutral-600 font-mono text-center py-12 border border-dashed border-neutral-800">No hay acciones programadas en agenda.</p>}
                </div>
              )}

              {activeDetailTab === 'historial' && (
                <div className="grid gap-6">
                  <div className="bg-neutral-900 border border-neutral-800 p-4 mb-4 text-neutral-400 text-sm font-bold uppercase tracking-widest flex items-center gap-2">
                    <CheckCircle2 className="w-4 h-4" /> Registro de Acciones Realizadas
                  </div>
                  {historialActions.map(([uuid, accion]) => (
                    <div key={uuid} className="bg-neutral-900 p-6 border border-neutral-800 opacity-90 hover:opacity-100 transition-opacity cursor-pointer" onClick={() => setSelectedAction(accion)}>
                      <div className="flex items-start gap-4">
                        <div className="p-3 bg-neutral-800 text-neutral-400">
                          {getActionIcon(accion.tipo)}
                        </div>
                        <div className="flex-1">
                          <div className="flex items-center gap-2 mb-2">
                            <span className="text-neutral-500 text-xs font-bold uppercase tracking-wider">
                              {getTypeLabel(accion.tipo)}
                            </span>
                            <span className="text-neutral-600 text-xs">•</span>
                            <span className="text-neutral-500 text-xs font-mono flex items-center gap-1">
                              <Calendar className="w-3 h-3" /> {new Date(accion.fecha + 'T12:00:00').toLocaleDateString('es-AR', { weekday: 'long', day: '2-digit', month: '2-digit', year: 'numeric' })}
                            </span>
                          </div>
                          <h3 className="text-xl font-bold text-neutral-200 mb-2 uppercase leading-snug">{accion.titulo}</h3>
                          <p className="text-neutral-400 mb-4 leading-relaxed text-sm">{accion.descripcion}</p>

                          <div className="flex flex-wrap items-center gap-4 text-sm">
                            <span className="text-neutral-500 font-bold text-xs uppercase">
                              LUGAR: {accion.lugar}
                            </span>
                            {accion.fuente && (
                              <a href={accion.fuente} target="_blank" rel="noreferrer" className="text-neutral-600 hover:text-white text-xs font-bold uppercase flex items-center gap-1">
                                Fuente <ExternalLink className="w-3 h-3" />
                              </a>
                            )}
                          </div>
                        </div>
                      </div>
                    </div>
                  ))}
                  {historialActions.length === 0 && <p className="text-neutral-600 font-mono text-center py-12 border border-dashed border-neutral-800">No hay historial reciente registrado.</p>}
                </div>
              )}

              {activeDetailTab === 'paritarias' && (
                <div className="grid gap-6">
                  {Object.entries(selectedUnion.paritarias || {}).map(([uuid, acuerdo]) => (
                    <div key={uuid} className="bg-neutral-900 p-8 border border-neutral-800 relative overflow-hidden group hover:border-green-900 transition-colors">
                      <div className="absolute top-0 right-0 p-4 opacity-5 group-hover:opacity-10 transition-opacity">
                        <FileText className="w-40 h-40 text-green-500" />
                      </div>
                      <div className="relative z-10">
                        <div className="inline-block bg-green-900/20 text-green-500 border border-green-900/40 px-3 py-1 text-xs font-bold uppercase mb-4 tracking-wider">
                          Acuerdo {acuerdo.periodo}
                        </div>
                        <div className="text-6xl font-black text-white mb-6 tracking-tighter">{acuerdo.porcentajeAumento}</div>
                        <div className="bg-neutral-950 p-6 border border-neutral-800 mb-6">
                          <p className="text-neutral-300 text-sm leading-relaxed font-mono">{acuerdo.detalleTexto}</p>
                        </div>
                        <div className="flex items-center gap-6 text-xs font-mono text-neutral-500 border-t border-neutral-800 pt-4">
                          <span className="flex items-center gap-2"><Clock className="w-3 h-3" /> FIRMA: {acuerdo.fechaFirma}</span>
                          <a href={acuerdo.enlaceFuente} target="_blank" rel="noreferrer" className="text-green-600 hover:text-green-400 hover:underline font-bold flex items-center gap-1">
                            VER DOCUMENTO OFICIAL <ExternalLink className="w-3 h-3" />
                          </a>
                        </div>
                      </div>
                    </div>
                  ))}
                  {Object.keys(selectedUnion.paritarias || {}).length === 0 && <p className="text-neutral-600 font-mono text-center py-12 border border-dashed border-neutral-800">Sin información paritaria reciente.</p>}
                </div>
              )}
            </div>
          </div>
        );
      }

      // --- DASHBOARD PRINCIPAL ---
      return (
        <div className="container mx-auto px-4 py-8">
          {/* MODAL FOR ACTION DETAILS */}
          {selectedAction && (
            <div className="fixed inset-0 z-[100] flex items-center justify-center bg-black/80 backdrop-blur-sm p-4 fade-in" onClick={() => setSelectedAction(null)}>
              <div className="bg-neutral-900 border border-neutral-700 max-w-2xl w-full max-h-[90vh] overflow-y-auto shadow-2xl relative slide-up" onClick={(e) => e.stopPropagation()}>
                <div className="p-6 border-b border-neutral-800 flex justify-between items-start sticky top-0 bg-neutral-900/95 backdrop-blur z-10">
                  <div>
                    <span className="inline-block px-2 py-0.5 bg-red-900/30 text-red-400 border border-red-900/50 text-[10px] font-black uppercase tracking-wider mb-2">
                      {getTypeLabel(selectedAction.tipo)}
                    </span>
                    <h2 className="text-xl md:text-2xl font-black text-white leading-tight">{selectedAction.titulo}</h2>
                    <div className="flex items-center gap-2 mt-2 text-xs text-neutral-500 font-mono">
                      <Calendar className="w-3 h-3" /> {new Date(selectedAction.fecha + 'T12:00:00').toLocaleDateString('es-AR', { weekday: 'long', day: '2-digit', month: '2-digit', year: 'numeric' })}
                    </div>
                  </div>
                  <button onClick={() => setSelectedAction(null)} className="text-neutral-500 hover:text-white p-2">
                    <X className="w-6 h-6" />
                  </button>
                </div>
                <div className="p-6 space-y-4">
                  <div className="text-neutral-300 font-medium text-lg leading-relaxed border-l-4 border-red-600 pl-4 italic">
                    {selectedAction.descripcion}
                  </div>
                  <div className="text-neutral-400 text-sm leading-relaxed space-y-4 font-serif">
                    <p>Información extraída de la fuente oficial.</p>
                  </div>
                </div>
                <div className="p-6 border-t border-neutral-800 bg-neutral-950">
                  <div className="flex flex-wrap items-center gap-4 mb-4">
                    <span className="text-neutral-400 font-bold bg-neutral-950 border border-neutral-800 px-2 py-1 text-xs uppercase">
                      LUGAR: {selectedAction.lugar}
                    </span>
                  </div>
                  {selectedAction.fuente && (
                    <a
                      href={selectedAction.fuente}
                      target="_blank"
                      rel="noreferrer"
                      className="w-full bg-red-700 hover:bg-red-600 text-white font-bold py-3 uppercase tracking-wider text-sm flex items-center justify-center gap-2 transition-colors"
                    >
                      Ver Fuente Oficial <ExternalLink className="w-4 h-4" />
                    </a>
                  )}
                </div>
              </div>
            </div>
          )}

          <div className="mb-4"></div>

          <div className="flex flex-row gap-4 mb-10 border-b border-neutral-800 pb-1">
            <button
              onClick={() => setActiveMainTab('monitor')}
              className={`nav-button flex-1 border border-b-0 flex flex-row md:flex-col items-center justify-center gap-1 transition-all group ${activeMainTab === 'monitor' ? 'bg-red-700 border-red-700 text-white' : 'bg-neutral-900 border-neutral-800 text-neutral-500 hover:bg-neutral-800'}`}
            >
              <AlertOctagon className={`w-6 h-6 ${activeMainTab === 'monitor' ? 'text-white' : 'text-red-600 group-hover:scale-110 transition-transform'}`} />
              <span className="hidden md:block font-black uppercase tracking-widest text-xs">AGENDA</span>
            </button>

            <button
              onClick={() => setActiveMainTab('sindicatos')}
              className={`nav-button flex-1 border border-b-0 flex flex-row md:flex-col items-center justify-center gap-1 transition-all group ${activeMainTab === 'sindicatos' ? 'bg-neutral-100 border-white text-neutral-900' : 'bg-neutral-900 border-neutral-800 text-neutral-500 hover:bg-neutral-800'}`}
            >
              <LayoutGrid className={`w-6 h-6 ${activeMainTab === 'sindicatos' ? 'text-neutral-900' : 'text-neutral-400 group-hover:scale-110 transition-transform'}`} />
              <span className="hidden md:block font-black uppercase tracking-widest text-xs">Sindicatos</span>
            </button>

            <button
              onClick={() => setActiveMainTab('noticias')}
              className={`nav-button flex-1 border border-b-0 flex flex-row md:flex-col items-center justify-center gap-1 transition-all group ${activeMainTab === 'noticias' ? 'bg-neutral-800 border-neutral-700 text-white' : 'bg-neutral-900 border-neutral-800 text-neutral-500 hover:bg-neutral-800'}`}
            >
              <Radio className={`w-6 h-6 ${activeMainTab === 'noticias' ? 'text-blue-500' : 'text-neutral-400 group-hover:scale-110 transition-transform'}`} />
              <span className="hidden md:block font-black uppercase tracking-widest text-xs">Noticias</span>
            </button>
          </div>

          <div className="min-h-[400px]">
            {activeMainTab === 'monitor' && (
              <div className="grid lg:grid-cols-2 gap-8 fade-in">
                <div className="bg-neutral-900 border-2 border-red-900/50 p-0 flex flex-col h-full relative overflow-hidden shadow-2xl shadow-red-900/10">
                  <div className="absolute top-0 right-0 w-2 h-full bg-red-600"></div>
                  <div className="bg-red-950/30 p-4 border-b border-red-900/30 flex items-center justify-between">
                    <h3 className="text-lg font-black text-red-500 uppercase tracking-wider flex items-center gap-2">
                      <Megaphone className="w-5 h-5" /> Agenda
                    </h3>
                    <span className="text-xs font-mono text-red-400 animate-pulse font-bold">EN CURSO / PRÓXIMO</span>
                  </div>
                  <div className="divide-y divide-red-900/20">
                    {upcomingActions.length > 0 ? (
                      upcomingActions.map((item, i) => (
                        <div key={i} className="p-4 bg-red-950/10 hover:bg-red-900/20 transition-colors relative cursor-pointer" onClick={() => setSelectedAction(item.action)}>
                          <div className="flex justify-between items-start mb-2">
                            <div className="flex items-center gap-2">
                              {item.unionLogo && <img src={item.unionLogo} alt="" className="w-6 h-6 rounded-full" onError={(e) => { e.target.style.display = 'none'; }} />}
                              <span className="inline-block px-1.5 py-0.5 bg-white text-black text-[11px] font-black uppercase tracking-wider">
                                {item.unionSlug}
                              </span>
                            </div>
                            <span className="text-red-400 text-xs font-mono font-bold">{new Date(item.action.fecha + 'T12:00:00').toLocaleDateString('es-AR', { weekday: 'long', day: '2-digit', month: '2-digit', year: 'numeric' })}</span>
                          </div>
                          <h4 className="text-white font-bold leading-tight uppercase mb-1">{item.action.titulo}</h4>
                          <p className="text-neutral-400 text-sm mb-2 line-clamp-2">{item.action.descripcion}</p>
                          <div className="flex items-center gap-2 text-xs text-neutral-500">
                            <span className="text-red-400 uppercase font-bold">{getTypeLabel(item.action.tipo)}</span>
                            <span>•</span>
                            <span>{item.action.lugar}</span>
                          </div>
                        </div>
                      ))
                    ) : (
                      <div className="p-12 text-center text-neutral-600 italic">No hay medidas de fuerza programadas próximamente.</div>
                    )}
                  </div>
                </div>

                <div className="bg-neutral-900 border border-neutral-800 p-0 flex flex-col h-full shadow-2xl">
                  <div className="bg-neutral-800 p-4 border-b border-neutral-700 flex items-center justify-between">
                    <h3 className="text-lg font-black text-white uppercase tracking-wider flex items-center gap-2">
                      <Clock className="w-5 h-5 text-neutral-400" /> Historial
                    </h3>
                    <span className="text-xs font-mono text-neutral-500">ÚLTIMOS REPORTES</span>
                  </div>
                  <div className="divide-y divide-neutral-800">
                    {pastActions.length > 0 ? (
                      pastActions.map((item, i) => (
                        <div key={i} className="p-4 hover:bg-neutral-800/50 transition-colors cursor-pointer" onClick={() => setSelectedAction(item.action)}>
                          <div className="flex justify-between items-start mb-2">
                            <div className="flex items-center gap-2">
                              {item.unionLogo && <img src={item.unionLogo} alt="" className="w-4 h-4 rounded-full" onError={(e) => { e.target.style.display = 'none'; }} />}
                              <span className="inline-block px-1.5 py-0.5 bg-neutral-800 text-neutral-400 border border-neutral-700 text-[10px] font-black uppercase tracking-wider">
                                {item.unionSlug}
                              </span>
                            </div>
                            <span className="text-neutral-500 text-xs font-mono">{new Date(item.action.fecha + 'T12:00:00').toLocaleDateString('es-AR', { weekday: 'long', day: '2-digit', month: '2-digit', year: 'numeric' })}</span>
                          </div>
                          <h4 className="text-white font-bold leading-tight uppercase mb-1">{item.action.titulo}</h4>
                          <div className="flex items-center gap-2 text-xs text-neutral-500 mb-2">
                            <span className="text-neutral-400 font-bold">{getTypeLabel(item.action.tipo)}</span>
                            <span>•</span>
                            <span>{item.action.lugar}</span>
                          </div>
                        </div>
                      ))
                    ) : (
                      <div className="p-12 text-center text-neutral-600 italic">No hay acciones recientes registradas.</div>
                    )}
                  </div>
                </div>
              </div>
            )}

            {activeMainTab === 'sindicatos' && (
              <div className="fade-in">
                {/* Controles de ordenamiento */}
                <div className="bg-neutral-900 border border-neutral-800 p-4 mb-6 flex items-center justify-between">
                  <div className="flex gap-2">
                    <button
                      onClick={() => setSortType('paritarias')}
                      className={`px-4 py-2 text-xs font-bold uppercase tracking-wider border transition-all ${sortType === 'paritarias'
                        ? 'bg-green-700 border-green-600 text-white'
                        : 'bg-neutral-800 border-neutral-700 text-neutral-400 hover:bg-neutral-700'
                        }`}
                    >
                      PARITARIAS
                    </button>
                    <button
                      onClick={() => setSortType('acciones')}
                      className={`px-4 py-2 text-xs font-bold uppercase tracking-wider border transition-all ${sortType === 'acciones'
                        ? 'bg-red-700 border-red-600 text-white'
                        : 'bg-neutral-800 border-neutral-700 text-neutral-400 hover:bg-neutral-700'
                        }`}
                    >
                      ACCIONES
                    </button>
                    <button
                      onClick={() => setSortType('az')}
                      className={`px-4 py-2 text-xs font-bold uppercase tracking-wider border transition-all ${sortType === 'az'
                        ? 'bg-blue-700 border-blue-600 text-white'
                        : 'bg-neutral-800 border-neutral-700 text-neutral-400 hover:bg-neutral-700'
                        }`}
                    >
                      AZ
                    </button>
                  </div>
                  {sortType && (
                    <div className="text-xs text-neutral-500 font-mono">
                      {sortType === 'acciones'
                        ? 'Ordenado por próxima acción más cercana'
                        : sortType === 'paritarias'
                          ? 'Ordenado por total de paritarias del año'
                          : 'Ordenado alfabéticamente'
                      }
                    </div>
                  )}
                </div>

                {sortedUnions.length === 0 ? (
                  <div className="text-center py-24 bg-neutral-900 border border-dashed border-neutral-800 rounded-none">
                    <h3 className="text-xl text-neutral-300 font-bold mb-2 uppercase">Sin datos para ordenar</h3>
                    <p className="text-neutral-500 text-sm">
                      {sortType === 'acciones'
                        ? 'No hay sindicatos con acciones próximas registradas.'
                        : sortType === 'paritarias'
                          ? 'No hay sindicatos con paritarias registradas.'
                          : 'El personal de inteligencia debe cargar informes en la Sala de Situación.'
                      }
                    </p>
                  </div>
                ) : (
                  <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    {sortedUnions.map((union, idx) => (
                      <UnionCard
                        key={idx}
                        data={union}
                        onSelect={setSelectedUnion}
                        rank={union.rank}
                        sortType={sortType}
                        sortValue={union.sortValue}
                        previousYearValue={union.previousYearValue}
                      />
                    ))}
                  </div>
                )}
              </div>
            )}

            {activeMainTab === 'noticias' && (
              <div className="fade-in">
                <NewsFeed
                  news={news}
                  loading={newsLoading}
                  error={newsError}
                  onRefresh={onRefreshNews}
                />
              </div>
            )}
          </div>
        </div>
      );
    };

    // --- APP COMPONENT ---
    const StandaloneApp = () => {
      const [unions, setUnions] = useState([]);
      const [news, setNews] = useState([]);
      const [newsLoading, setNewsLoading] = useState(false);
      const [newsError, setNewsError] = useState(false);

      const fetchNews = useCallback(async () => {
        setNewsLoading(true);
        setNewsError(false);
        const SOURCES = [
          { name: 'InfoGremiales', url: 'https://www.infogremiales.com.ar/feed/' },
          { name: 'Sonido Gremial', url: 'https://sonidogremial.com.ar/feed/' },
          { name: 'Identidad Sindical', url: 'https://www.identidadsindical.ar/rss/' },
          { name: 'Mundo Gremial', url: 'https://mundogremial.com/feed/' },
          { name: 'Gestión Sindical', url: 'https://gestionsindical.com/feed/' }
        ];
        const allNews = [];

        try {
          const promises = SOURCES.map(async (source) => {
            try {
              const res = await fetch(`https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(source.url)}`);
              const data = await res.json();
              if (data.status === 'ok') {
                return data.items.map((item) => ({
                  title: item.title,
                  link: item.link,
                  pubDate: item.pubDate,
                  source: source.name,
                  description: item.description?.replace(/<[^>]+>/g, '').substring(0, 200) + '...' || '',
                  content: item.content || item.description || ''
                }));
              }
              return [];
            } catch (e) {
              console.error(`Error fetching ${source.name}:`, e);
              return [];
            }
          });

          const results = await Promise.all(promises);
          results.forEach(items => allNews.push(...items));
          allNews.sort((a, b) => new Date(b.pubDate).getTime() - new Date(a.pubDate).getTime());
          setNews(allNews);
        } catch (err) {
          console.error("Error fetching news:", err);
          setNewsError(true);
        } finally {
          setNewsLoading(false);
        }
      }, []);

      useEffect(() => {
        const fetchUnions = async () => {
          try {
            const response = await fetch(`${DB_URL}/sindicatos.json${AUTH}`);
            const data = await response.json();
            if (data) {
              setUnions(Object.values(data).map(sanitizeUnionData));
            }
          } catch (e) {
            console.error("Error fetching DB", e);
          }
        };

        fetchUnions();
        fetchNews();
      }, [fetchNews]);

      return (
        <div className="min-h-screen flex flex-col bg-neutral-950 text-neutral-200">
          {/* Navbar Actualizado */}
          <nav className="bg-neutral-900 border-b border-neutral-800 sticky top-0 z-50 cursor-pointer" onClick={() => window.scrollTo({ top: 0, behavior: 'smooth' })}>
            <div className="container mx-auto px-4 h-16 flex items-center justify-between">
              <div className="flex items-center gap-3 font-black text-2xl text-white tracking-tighter uppercase">
                <div className="bg-red-700 text-white p-1.5 shadow-lg shadow-red-900/50">
                  <Radio className="w-5 h-5" />
                </div>
                {/* CAMBIO: De SN a DeClase */}
                <span>De<span className="text-red-600">Clase</span></span>

                {/* 2. HEADER WIDGET (HORA Y CLIMA) */}
                <div className="hidden md:block ml-6 border-l border-neutral-800 pl-6">
                  <HeaderWidget />
                </div>
              </div>

              {/* Mobile Header Widget Fallback */}
              <div className="md:hidden">
                <HeaderWidget />
              </div>
            </div>
          </nav>

          <EconomicTicker />

          <main className="flex-1 bg-neutral-950 relative flex flex-col">
            <div className="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre.png')] opacity-10 pointer-events-none"></div>
            <PublicView
              unions={unions}
              news={news}
              newsLoading={newsLoading}
              newsError={newsError}
              onRefreshNews={fetchNews}
            />
          </main>

          {/* 4. FOOTER LIMPIO */}
          <footer className="bg-neutral-900 border-t border-neutral-800 py-6 mt-auto">
            <div className="container mx-auto px-4 flex justify-center items-center text-neutral-600 text-[10px] font-mono uppercase tracking-widest">
              <div className="flex items-center gap-2">
                <span>SISTEMA DE MONITOREO</span>
                <span className="text-red-900">•</span>
                <span>SOLO USO AUTORIZADO</span>
              </div>
            </div>
          </footer>
        </div>
      );
    };

    const root = createRoot(document.getElementById('root'));
    root.render(<StandaloneApp />);
  </script>
</body>

</html>
